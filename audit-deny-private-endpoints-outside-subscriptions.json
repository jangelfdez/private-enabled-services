{
	"mode": "All",
	"policyRule": {
		"if": {
			"allOf": [
				{
					"field": "type",
					"equals": "Microsoft.Network/privateEndpoints"
				},
        {
          "anyOf": [
            {
              "value": "[split(field('Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].privateLinkServiceId'), '/')[2]]",
              "notIn": "[parameters('allowedSubscriptions')]"
            },
            {
              "value": "[split(field('Microsoft.Network/privateEndpoints/manualPrivateLinkServiceConnections[*].privateLinkServiceId'), '/')[2]]",
              "notIn": "[parameters('allowedSubscriptions')]"
            }
          ]
        }
			]

		},
		"then": {
			"effect": "[parameters('effect')]"
		}
	},
	"parameters": {
		"effect": {
			"type": "String",
			"metadata": {
				"displayName": "Select the effect of this policy",
				"description": "Configures the effect of this policy. Default value is Audit."
			},
			"defaultValue": "Audit",
			"allowedValues": [
				"Audit",
				"Deny",
				"Disabled"
			]
		},
		"allowedSubscriptions": {
			"type": "Array",
			"metadata": {
				"displayName": "Allowed subscriptions",
				"description": "List of subscriptions that contain resources allowed as a target for a Private Endpoint"
			}
		}
	}
}